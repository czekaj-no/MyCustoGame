{% extends 'store/account_base.html' %}
{% load static %}
{% block account_content %}

<h2>üì≤ Twoje kody QR</h2>

{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="message {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}

{% for entry in items %}
  <div class="qr-box">
    <h3>{{ entry.item.product.category.name }} ‚Üí <strong>{{ entry.item.product.title }}</strong></h3>

    {% for qr in entry.qrs %}
      <div class="qr-preview">
        <h4>Sztuka {{ forloop.counter }}</h4>

        {% if qr.image %}
          <img src="{{ qr.image.url }}" width="200" alt="Kod QR">
          <br>
          <a href="{{ qr.image.url }}" download class="cta-button small">‚¨áÔ∏è Pobierz kod</a>
        {% else %}
          <p class="qr-status qr-warning">‚ö†Ô∏è Kod QR nie zosta≈Ç jeszcze wygenerowany.</p>
        {% endif %}

        {% if qr.url %}
          <p><strong>Link docelowy:</strong> <a href="{{ qr.url }}" target="_blank">{{ qr.url }}</a></p>
          <p class="qr-warning">‚ö†Ô∏è Uwaga: po zmianie linku, poprzedni kod QR przestanie dzia≈Çaƒá.</p>
        {% else %}
          <p class="qr-status">üîó Link nie zosta≈Ç jeszcze przypisany.</p>
        {% endif %}

        <!-- Formularz zawsze dostƒôpny -->
        <form method="post" class="qr-form">
          {% csrf_token %}
          <input type="hidden" name="qr_id" value="{{ qr.id }}">
          <input type="url"
                 name="url"
                 placeholder="{% if qr.url %}Wprowad≈∫ nowy link{% else %}Wklej link (np. do Google Drive){% endif %}"
                 required>
          <button type="submit" class="cta-button">
            {% if qr.url %}Zmie≈Ñ link{% else %}Zatwierd≈∫ link{% endif %}
          </button>
        </form>
      </div>
    {% endfor %}
  </div>
{% endfor %}

{% endblock %}
